## WebSocket: 소개 및 기술적 이해

### 1. WebSocket 프로토콜의 정의 및 배경
- WebSocket은 웹 애플리케이션에서 실시간 양방향 통신을 가능하게 하는 고급 통신 프로토콜입니다.
- 이 프로토콜은 HTTP의 한계를 극복하고, 더욱 동적인 사용자 경험을 제공하기 위해 개발되었습니다. 
- HTTP는 요청-응답 패턴으로만 동작하는 반면, WebSocket은 지속적이고 실시간의 데이터 교환을 지원합니다.

### 2. 기본 특성 및 기술적 세부사항
- TCP 기반: WebSocket 연결은 TCP/IP 프로토콜을 기반으로 안정적인 연결을 제공합니다.
- 양방향 통신: 연결된 클라이언트와 서버는 지속적으로 데이터를 교환할 수 있습니다.
- 프레임 기반의 데이터 전송: 데이터는 텍스트, 바이너리, 또는 제어 프레임의 형태로 나누어져 전송되며, 각 프레임은 'fin' 비트를 포함해 메시지의 시작과 종료를 표시합니다.

### 3. WebSocket 연결 및 유지 관리
- Handshake 과정: WebSocket 연결은 HTTP 요청을 통한 초기 핸드셰이크로 시작되며, 이때 서버와 클라이언트는 WebSocket 프로토콜로의 전환을 협의합니다.
- ![CH14_01. WebSocket의 기본 개념과 필요성-1.png](CH14_01.%20WebSocket%EC%9D%98%20%EA%B8%B0%EB%B3%B8%20%EA%B0%9C%EB%85%90%EA%B3%BC%20%ED%95%84%EC%9A%94%EC%84%B1-1.png)
- 연결 유지: 정기적인 '핑'과 '퐁' 메시지 교환을 통해 연결 상태를 유지 관리합니다.
- ![CH14_01. WebSocket의 기본 개념과 필요성-3.png](CH14_01.%20WebSocket%EC%9D%98%20%EA%B8%B0%EB%B3%B8%20%EA%B0%9C%EB%85%90%EA%B3%BC%20%ED%95%84%EC%9A%94%EC%84%B1-3.png)
- 보안 연결 (WSS): 보안이 중요한 데이터 전송에는 WebSocket Secure를 사용하여 TLS를 통해 데이터를 암호화합니다.

### 4. 실시간 통신의 효율성
- WebSocket은 프로토콜 오버헤드를 최소화하고, 네트워크 대기 시간을 줄여 실시간 애플리케이션에서 뛰어난 성능을 발휘합니다. 각 메시지에 대한 별도의 HTTP 헤더가 필요 없어 전송 효율이 크게 개선됩니다.
- ![CH14_01. WebSocket의 기본 개념과 필요성-2.png](CH14_01.%20WebSocket%EC%9D%98%20%EA%B8%B0%EB%B3%B8%20%EA%B0%9C%EB%85%90%EA%B3%BC%20%ED%95%84%EC%9A%94%EC%84%B1-2.png)
- ![CH14_01. WebSocket의 기본 개념과 필요성-4.png](CH14_01.%20WebSocket%EC%9D%98%20%EA%B8%B0%EB%B3%B8%20%EA%B0%9C%EB%85%90%EA%B3%BC%20%ED%95%84%EC%9A%94%EC%84%B1-4.png)

### 5. OpCode 종류
- 0x0 (연속 프레임): 이전 프레임의 연속으로, 페이로드 데이터의 끝을 표시하지 않습니다. 연속 프레임들은 같은 메시지의 일부로 처리됩니다. 
- 0x1 (텍스트 프레임): 텍스트 데이터를 전송하는 데 사용됩니다. 페이로드는 UTF-8로 인코딩된 텍스트를 포함합니다.
- 0x2 (바이너리 프레임): 바이너리 데이터를 전송하는 데 사용됩니다. 텍스트와 달리 어떠한 형식의 데이터도 전송할 수 있으므로 다양한 애플리케이션에서 활용할 수 있습니다.
- 0x8 (연결 종료 프레임): WebSocket 연결을 종료할 때 사용됩니다. 이 프레임은 종료 코드와 선택적인 종료 이유를 포함할 수 있습니다.
- 0x9 (핑 프레임): 연결이 여전히 활성 상태임을 확인하기 위해 주기적으로 전송됩니다. 이 프레임을 받은 측은 가능한 한 빠르게 퐁 프레임을 보내 응답해야 합니다.
- 0xA (퐁 프레임): 핑 프레임에 대한 응답으로 사용됩니다. 이 프레임은 연결이 여전히 활성 상태이고 정상적으로 작동 중임을 나타냅니다.

### 6. 사용 사례
- WebSocket은 온라인 게임, 금융 거래 플랫폼, 실시간 채팅 애플리케이션 등 다양한 분야에서 활용됩니다.

### 7. 간단 실습
- 기본 Jakarta EE를 사용한 웹소켓 실습
  - `jakarta.servlet:jakarta.servlet-api`
    - Jakarta EE의 일부로, Java 웹 개발에 필수적인 서블릿 API를 제공
    - 서블릿 API는 HTTP 요청을 처리하고 응답을 관리하는 서버사이드 프로그램을 작성
  - `org.glassfish.tyrus:tyrus-container-grizzly-server`
    - Grizzly는 NIO 기반의 웹서버와 런타임으로, Tyrus와의 통합을 통해 고성능 웹소켓 서버를 구현 가능
    - WebSocket 프로토콜 지원: WebSocket 연결, 데이터 전송, 세션 관리 등 WebSocket 프로토콜을 지원하는 모든 기능을 제공