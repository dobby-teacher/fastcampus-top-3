## Kubernetes 배포 설계 및 클러스터 설정
Kubernetes는 컨테이너화된 애플리케이션의 배포, 확장 및 관리를 자동화하는 오픈 소스 플랫폼입니다. Google에서 개발되었으며 현재는 CNCF(Cloud Native Computing Foundation)에서 관리하고 있습니다.

### 주요 특징
- **자동화된 배포 및 복구**: 애플리케이션을 자동으로 배포하고 장애 발생 시 자동으로 복구합니다.
- **확장성**: 트래픽 변화에 따라 애플리케이션의 인스턴스를 자동으로 증가 또는 감소시킵니다.
- **서비스 디스커버리와 로드 밸런싱**: 자동으로 서비스 디스커버리를 제공하고 트래픽을 로드 밸런싱합니다.
- **Secret 관리 및 구성 관리**: 비밀과 애플리케이션 설정을 안전하게 관리합니다.

## 2. Kubernetes의 주요 구성 요소
### 클러스터
Kubernetes 클러스터는 하나 이상의 마스터 노드와 여러 워커 노드로 구성됩니다.
- **마스터 노드**: 클러스터의 컨트롤 플레인 역할을 하며 클러스터의 상태를 관리합니다.
- **워커 노드**: 컨테이너화된 애플리케이션을 실행합니다.

### 주요 구성 요소
- **kube-apiserver**: Kubernetes API를 제공하는 컴포넌트입니다.
- **etcd**: 클러스터의 상태 정보를 저장하는 분산 키-값 저장소입니다.
- **kube-scheduler**: 새로 생성된 Pod를 적절한 노드에 할당합니다.
- **kube-controller-manager**: 클러스터 상태를 원하는 상태로 유지하는 컨트롤러들을 실행합니다.
- **kubelet**: 각 노드에서 실행되며 컨테이너의 생명주기를 관리합니다.
- **kube-proxy**: 네트워킹을 관리하고 클러스터 내 통신을 처리합니다.

## 3. 클러스터 설정 전 준비사항
- Docker Desktop 설치 및 K8S 설정 켜기

## 4. Kubernetes Dashboard 설치 및 접속
- 쿠버네티스 공식 github에서 제공하는 yaml을 사용
```
kubectl apply -f https://raw.githubusercontent.com/kubernetes/dashboard/v2.4.0/aio/deploy/recommended.yaml
```
- 대시보드 설치 완료 확인
```
kubectl get deployment -n kubernetes-dashboard
```
- proxy 설정
```
kubectl proxy
```
- 브라우저에서 접근
```
http://localhost:8001/api/v1/namespaces/kubernetes-dashboard/services/https:kubernetes-dashboard:/proxy/#/login
```
- 해당 service-account 생성
```
-- service-account.yaml
apiVersion: v1
kind: ServiceAccount
metadata:
  name: dashboard-admin
  namespace: kubernetes-dashboard
```
- service-account 적용
```
kubectl apply -f service-account.yaml
```
- 권한 부여 파일 생성
```
-- cluster-role-binding.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: dashboard-admin
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: cluster-admin
subjects:
- kind: ServiceAccount
  name: dashboard-admin
  namespace: kubernetes-dashboard
```
- 권한 부여
```
kubectl apply -f cluster-role-binding.yaml
```
- 토큰 발급
```
kubectl -n kubernetes-dashboard create token dashboard-admin
```

### kubectl proxy의 주요 역할
- 로컬 접근을 통한 클러스터 API 접근:
  - kubectl proxy를 사용하면 로컬 시스템에서 Kubernetes 클러스터의 API 서버에 쉽게 접근할 수 있습니다. 로컬 호스트에 HTTP 서버를 실행하여 클러스터 API 서버에 대한 요청을 중계합니다.
- 보안 강화
  - 프록시는 클러스터 인증과 권한 부여를 처리합니다. 이를 통해 사용자 자격 증명이 로컬 호스트에서 클러스터 API 서버로 안전하게 전달됩니다.
kubectl proxy는 사용자 인증 정보를 자동으로 포함하므로, 클러스터에 직접 접근하는 것보다 보안 측면에서 안전합니다.
- API 탐색 및 디버깅:
  - kubectl proxy를 사용하면 API 리소스와 엔드포인트를 쉽게 탐색할 수 있습니다. API 서버의 엔드포인트에 직접 접근하여 클러스터 리소스를 조회하고 디버깅할 수 있습니다.

## 5. 클러스터 설정 확인
### 노드 확인
```sh
kubectl get nodes
```