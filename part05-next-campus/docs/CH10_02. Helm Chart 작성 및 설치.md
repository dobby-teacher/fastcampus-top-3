## Helm Chart 
### Helm Chart란?
Helm Chart는 Kubernetes 애플리케이션의 패키지 매니저입니다. Kubernetes 클러스터에서 애플리케이션을 정의하고 설치하는 데 필요한 모든 Kubernetes 리소스를 하나의 패키지로 묶은 것입니다. Helm Chart를 사용하면 Kubernetes 애플리케이션의 배포, 업그레이드, 롤백, 삭제를 쉽게 관리할 수 있습니다.

### Helm Chart의 구성 요소

1. **Chart.yaml**: 차트의 메타데이터를 포함합니다. 이름, 버전, 설명 등을 정의합니다.
2. **values.yaml**: 기본 값들을 정의합니다. 사용자가 이 파일을 수정하여 차트의 설정을 쉽게 변경할 수 있습니다.
3. **templates/**: Kubernetes 리소스 정의 파일(템플릿)이 들어있는 디렉토리입니다. 이 파일들은 Go 템플릿 언어를 사용하여 동적으로 구성될 수 있습니다.
4. **charts/**: 차트의 종속성 차트가 들어있는 디렉토리입니다.
5. **README.md**: 차트 사용법에 대한 설명이 포함될 수 있습니다.

### Helm Chart가 왜 필요한가?

#### 1. **배포의 간소화**
Helm Chart를 사용하면 복잡한 Kubernetes 애플리케이션을 한 번에 쉽게 배포할 수 있습니다. 애플리케이션을 배포하는 데 필요한 모든 리소스를 하나의 패키지로 묶어, 단일 명령어로 설치할 수 있습니다.

#### 2. **재사용성**
Helm Chart는 한 번 작성하면 여러 클러스터와 환경에서 재사용할 수 있습니다. 이를 통해 DevOps 팀은 일관된 방식으로 애플리케이션을 배포할 수 있습니다.

#### 3. **버전 관리**
Helm Chart는 버전 관리를 지원합니다. 이를 통해 특정 버전의 차트를 쉽게 설치하거나 업그레이드할 수 있으며, 필요할 경우 이전 버전으로 롤백할 수 있습니다.

#### 4. **설정의 유연성**
Helm Chart는 `values.yaml` 파일을 통해 다양한 설정을 지원합니다. 사용자는 이 파일을 수정하여 특정 환경에 맞게 설정을 조정할 수 있습니다. 또한, 사용자 정의 값을 `--set` 플래그를 사용하여 명령어 라인에서 직접 설정할 수도 있습니다.

#### 5. **종속성 관리**
Helm Chart는 차트 간의 종속성을 관리할 수 있습니다. 예를 들어, 애플리케이션이 데이터베이스를 필요로 하는 경우, 데이터베이스 차트를 애플리케이션 차트의 종속성으로 지정하여 함께 설치할 수 있습니다.

### Helm Chart의 사용 사례

1. **애플리케이션 배포**: Helm Chart를 사용하여 웹 애플리케이션, 데이터베이스, 메시지 큐 등 다양한 Kubernetes 애플리케이션을 배포할 수 있습니다.
2. **CI/CD 파이프라인**: Helm Chart는 CI/CD 파이프라인에서 Kubernetes 애플리케이션을 배포하는 데 자주 사용됩니다. 이를 통해 자동화된 배포와 업데이트가 가능합니다.
3. **공유 가능한 패키지**: Helm Chart는 패키지 레지스트리(예: Helm Hub, Artifact Hub)를 통해 공유할 수 있습니다. 이를 통해 커뮤니티 또는 팀 내에서 차트를 쉽게 배포하고 사용할 수 있습니다.

## Infrastructure를 위한 Helm Chart 설치
### Helm 설치
```
# mac
brew install helm

# windows
choco install kubernetes-helm
```

### MySQL 설치
```bash
helm repo add bitnami https://charts.bitnami.com/bitnami
helm install next-campus-mysql bitnami/mysql --set auth.rootPassword=fast,primary.service.port=3306
```

### Redis 설치
```bash
helm repo add bitnami https://charts.bitnami.com/bitnami
helm install next-campus-redis bitnami/redis --set master.service.port=6379
```

### Elasticsearch 설치
```bash
helm repo add elastic https://helm.elastic.co
helm install next-campus-elasticsearch elastic/elasticsearch --set service.type=ClusterIP --set service.port=9200 --set volumeClaimTemplate.resources.requests.storage=8Gi
```

### Kibana 설치
```bash
helm repo add elastic https://helm.elastic.co
helm install next-campus-kibana elastic/kibana --set service.type=ClusterIP --set service.port=5601 --set env.ELASTICSEARCH_HOSTS=http://next-campus-elasticsearch:9200
```

### Zipkin 설치
```bash
helm repo add openzipkin https://openzipkin.github.io/zipkin
helm install next-campus-zipkin openzipkin/zipkin --set service.type=ClusterIP --set service.port=9411 --set env.STORAGE_TYPE=elasticsearch --set env.ES_HOSTS=http://next-campus-elasticsearch:9200
```

### Prometheus 설치
```bash
helm repo add prometheus-community https://prometheus-community.github.io/helm-charts
helm install next-campus-prometheus prometheus-community/prometheus --set server.service.type=ClusterIP --set server.service.port=9090
```

### Alertmanager 설치
```bash
helm repo add prometheus-community https://prometheus-community.github.io/helm-charts
helm install next-campus-alertmanager prometheus-community/alertmanager --set service.type=ClusterIP --set service.port=9093
```

### Node Exporter 설치
```bash
helm repo add prometheus-community https://prometheus-community.github.io/helm-charts
helm install next-campus-node-exporter prometheus-community/prometheus-node-exporter --set service.type=ClusterIP --set service.port=9100
```

### cAdvisor 설치
```bash
helm repo add stable https://charts.helm.sh/stable
helm install next-campus-cadvisor stable/cadvisor --set service.type=ClusterIP --set service.port=8085
```

### Grafana 설치
```bash
helm repo add grafana https://grafana.github.io/helm-charts
helm install next-campus-grafana grafana/grafana --set service.type=ClusterIP --set service.port=3000 --set persistence.size=8Gi
```

## Helm Chart 작성
- 각 서비스에 대해서 Helm Chart 작성
```
helm-charts/
  └── next-campus/
        ├── Chart.yaml
        ├── values.yaml
        └── templates/
            ├── next-discovery-deployment.yaml
            ├── next-discovery-service.yaml
            ├── next-gateway-deployment.yaml
            ├── next-gateway-service.yaml
            ├── next-graphql-deployment.yaml
            ├── next-graphql-service.yaml
            ├── next-course-service-deployment.yaml
            ├── next-course-service-service.yaml
            ├── next-enrollment-service-deployment.yaml
            ├── next-enrollment-service-service.yaml
            ├── next-file-manage-service-deployment.yaml
            ├── next-file-manage-service-service.yaml
            ├── next-file-manage-service-pvc.yaml
            ├── next-playback-service-deployment.yaml
            ├── next-playback-service-service.yaml
            ├── next-user-service-deployment.yaml
            └── next-user-service-service.yaml
```
